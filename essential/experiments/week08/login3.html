<html>
<head>
    <title>Week 08 Experiments</title>
    <link rel="stylesheet" href="../../css/week03/bootstrap-3.3.2-dist/css/bootstrap.min.css" />
    <script src="../../css/week05/angular.min.js"></script>
    <script src="../../css/week05/angular-route.js"></script>
</head>
<body>
    <div class="container jumbotron">
        <form name="myform" ng-app="LoginApp" novalidate>
        <h2>
            Form Input Validations</h2>
        <br />
        <div class="container jumbotron" ng-controller="LoginCtrl">
            <div class="row" ng-hide="user">
                <div class="col-md-3">
                    &nbsp;</div>
                <div class="col-md-4">
                    Email :
                    <input name="emailname" type="email" ng-model="emailmodel" required /><br />
                    <span style="color: red" ng-show="myform.emailname.$error.required">Enter Email Address
                        !!!</span> <span style="color: red" ng-show="myform.emailname.$error.email">Invalid
                            Email Address !!!</span>
                </div>
                <div class="col-md-4">
                    Password :
                    <input name="passname" type="password" ng-model="passmodel" required /><br />
                    <span style="color: red" ng-show="myform.passname.$error.required">Enter Password !!!</span>
                </div>
                <div class="col-md-1">
                    <input type="submit" ng-click="validate()" value="Login" ng-disabled="myform.emailname.$error.email || myform.emailname.$error.required || myform.passname.$error.required" />
                    <br />
                    <span style="color: red" ng-show="myform.emailname.$error.email || myform.emailname.$error.required || myform.passname.$error.required">
                        Disabled</span>
                </div>
            </div>
            <div class="row" ng-show="user">
                <div class="col-md-3">
                    &nbsp;</div>
                <div class="col-md-4">
                    &nbsp;</div>
                <div class="col-md-4">
                    &nbsp;</div>
                <div class="col-md-1">
                    <input type="submit" ng-click="logoutFn()" value="Logout" /><br />
                </div>
            </div>
            <h3>
                <nav>
                    <a href="#/home">Home</a> |
                    <span ng-show="user"><a href="#/profile/{{user.name}}">profile</a></span>
                </nav>
            </h3>
        </div>
        <div ng-view>
        </div>
        </form>
    </div>
    <script>

        var app = angular.module("LoginApp", ["ngRoute"]);

        app.config(['$routeProvider', 
        function ($routeProvider) {
            console.log("in config");
            $routeProvider.
            when('/home', {
                templateUrl: 'pages/home.html'
            }).
            when('/profile/:name', {
                templateUrl: 'pages/profile.html',
                controller: 'ProfCtrl'
            }).
            otherwise({
                redirectTo: '/home'
            });
        } ]);

        app.controller("ProfCtrl", function ($scope, UserService, $routeParams) {
            console.log("in profile Contrl");
            $scope.user = UserService.getUser();
        });

        app.controller("LoginCtrl", function ($scope, UserService) {
            console.log("in Login Contrl");
            $scope.user = null;
            $scope.validate = function () {
                var username = $scope.emailmodel;
                var password = $scope.passmodel;
                console.log("in validate");
                $scope.user = UserService.validate(username, password);
                console.log("after validate");
                console.log($scope.user);
            }

            $scope.logoutFn = function () {
                $scope.user = null;
                $scope.passmodel = null;
                $scope.emailmodel = null;
                UserService.logoutFn();
            }
        });


        app.factory("UserService", function () {
            var logins = [{ mail: "neelesh1@gmail.com", pass: "password", name: "Neelesh1", player: "Messi" },
                          { mail: "neelesh2@gmail.com", pass: "password", name: "Neelesh2", player: "Suarez" },
                          { mail: "neelesh3@gmail.com", pass: "password", name: "Neelesh3", player: "Neymar"}];

            var user = null;
            console.log("in factory");

            var validate = function (username, password) {
                console.log("in userservice validate");
                var flag = 0;
                for (var i = 0; i < logins.length; i++) {
                    if (username == logins[i].mail && password == logins[i].pass) {
                        user = logins[i];
                        return user;
                    }
                }
                return null;
            }

            var logoutFn = function () {
                user = null;
            }

            var getUser = function () {
                return user;
            }

            return {
                validate: validate,
                logoutFn: logoutFn,
                getUser: getUser
            }
        });

    </script>
</body>
</html>
